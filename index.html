<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ToDo Minimalist</title>
  <meta name="theme-color" content="#0ea5a4" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.9)); }
    /* CSS untuk animasi banner */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }
     /* Menyembunyikan input file asli */
    #photo {
        display: none;
    }
    /* Styling untuk tombol input foto */
    .custom-file-upload {
        display: inline-block;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 7px;
        font-size: 0.875rem;
        line-height: 1.25rem;
        font-weight: 500;
        background-color: #ffffff; /* bg-gray-200 */
        color: #4b5563; /* text-gray-600 */
        border: 1px solid #d1d5db;
    }
    .custom-file-upload:hover {
        background-color: #e5e7eb; /* hover:bg-gray-300 */
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-800">
	<div id="installBanner" class="hidden bg-green-100 border border-green-300 p-3 flex justify-between items-center fade-in-up">
    <img src="icon-512.png" alt="Install App" class="w-6 h-6 rounded-full border border-green-800">
    <div class="flex gap-2">
      <button id="installBtn" class="bg-green-500 text-white text-xs px-3 py-1 rounded">Install di layar utama</button>
      <button id="closeBanner" class="text-green-700 font-bold">✕</button>
    </div>
  </div>
  
  <div id="manualInstallBanner" class="hidden bg-yellow-100 border border-yellow-300 p-3 flex justify-between items-center fade-in-up">
    <span class="text-sm text-yellow-800">Untuk instal, klik menu browser &gt; Tambahkan ke layar utama</span>
    <button id="closeManualBanner" class="text-yellow-700 font-bold">✕</button>
  </div>
  
  <div class="max-w-5xl mx-auto p-4 sm:p-6">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-3">
      <div>
        <h1 class="text-2xl md:text-3xl font-extrabold">ToDo Minimalist</h1>
        <p class="text-sm text-gray-500">Tambah judul, harga & foto — simple, modern, offline-ready</p>
      </div>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- form -->
      <section class="md:col-span-1 card p-4 rounded-xl shadow">
        <h2 class="font-semibold mb-3">Tambah Item</h2>
        <form id="itemForm" class="space-y-3">
          <div>
            <label class="text-sm text-gray-600">Judul</label>
            <input id="title" class="w-full mt-1 p-2 border rounded focus:ring-2 focus:ring-teal-400 focus:outline-none" placeholder="Mie Ayam" required />
          </div>

          <div>
            <label class="text-sm text-gray-600">Harga</label>
            <input id="price" type="text" inputmode="numeric" class="w-full mt-1 p-2 border rounded focus:ring-2 focus:ring-teal-400 focus:outline-none" placeholder="Rp. 50.000" />
          </div>

          <div>
  <label class="text-sm text-gray-600">Prioritas</label>
  <div class="relative mt-1">
    <input type="hidden" id="priority" value="normal">

    <button type="button" id="priority-btn" class="w-full flex items-center justify-between text-left p-2 border rounded bg-white focus:ring-2 focus:ring-teal-400 focus:outline-none">
      <span id="priority-label">Biasa</span>
      <svg class="h-5 w-5 text-gray-400 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
    </button>

    <div id="priority-menu" class="hidden absolute mt-2 w-full bg-white border rounded-md shadow-lg z-20">
      <button type="button" data-value="normal" class="priority-option block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Biasa</button>
      <button type="button" data-value="important" class="priority-option block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Penting</button>
      <button type="button" data-value="urgent" class="priority-option block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Realisasi dulu</button>
    </div>
  </div>
</div>

          <div>
            <label class="text-sm text-gray-600">Foto (opsional)</label>
           	<div class="flex flex-col items-start space-y-3">
              <img id="photoPreview" class="mt-2 rounded max-h-40 object-contain hidden border size-20" alt="preview" />
              <label for="photo" class="custom-file-upload">Tambah Foto</label>
              <input id="photo" type="file" accept="image/*" />
            </div>
          </div>

          <div class="flex gap-2">
            <button type="submit" class="flex-1 bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">Tambah</button>
            <button id="clearBtn" type="button" class="px-4 py-2 border rounded hover:bg-gray-100">Bersihkan</button>
          </div>
        </form>
      </section>

      <!-- list -->
      <section class="md:col-span-2">
        <!-- filter/grid/export -->
        <div class="flex justify-end mb-3 gap-2 items-center relative">
          <!-- tombol filter -->
          <div class="relative">
            <button id="filterBtn" class="p-2 border rounded-lg hover:bg-gray-100">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18M6 8h12M9 12h6m-3 4h0"/>
              </svg>
            </button>
            <div id="filterMenu" class="hidden absolute right-0 mt-2 w-48 bg-white border rounded shadow-lg z-10">
              <button onclick="setSort('price')" class="filterOpt block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Harga (terendah)</button>
              <button onclick="setSort('priority')" class="filterOpt block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Prioritas</button>
              <button onclick="setSort('alphabet')" class="filterOpt block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Alfabet (A-Z)</button>
              <button onclick="setSort('time')" class="filterOpt block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Waktu (terbaru)</button>
            </div>
          </div>

          <!-- tombol grid -->
          <button id="toggleView" class="p-2 border rounded-lg hover:bg-gray-100" title="Grid/List">
            <svg id="gridIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-view="list">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
          <button id="exportBtn" class="p-2 border rounded-lg text-sm bg-teal-500 text-white hover:bg-teal-600">TXT</button>
        </div>

        <div class="card p-4 rounded-xl shadow">
          <h2 class="font-semibold mb-3">Daftar</h2>
          <ul id="list" class="grid gap-3"></ul>
          <div class="mt-4 flex gap-2">
            <button id="clearAll" class="px-3 py-2 border rounded text-sm text-red-600 hover:bg-red-50">Hapus Semua</button>
            <div class="ml-auto text-sm text-gray-500" id="count">0 item</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="text-center text-xs text-gray-400 mt-6">Made minimalist • Works offline • PWA-ready</footer>
  </div>

  <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
      <h3 class="text-lg font-bold text-gray-800">Konfirmasi</h3>
      <p class="mt-2 text-sm text-gray-600">Anda yakin ingin menghapus semua item? Tindakan ini tidak dapat dibatalkan.</p>
      <div class="mt-6 flex justify-end gap-3">
        <button id="cancel-btn" class="px-4 py-2 border rounded text-sm font-medium hover:bg-gray-100">
          Batal
        </button>
        <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded text-sm font-medium hover:bg-red-700">
          Ya, Hapus
        </button>
      </div>
    </div>
  </div>

  <script>
    let todos = JSON.parse(localStorage.getItem('todos') || '[]');
    const listEl = document.getElementById('list');
    const photoInput = document.getElementById('photo');
    const photoPreview = document.getElementById('photoPreview');
    const priceInput = document.getElementById('price');
    let sortValue = "default";
    let isGrid = false;

    // format Rupiah realtime
    function formatRupiah(angka) {
      if (!angka) return "";
      return "Rp " + angka.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }
    priceInput.addEventListener("input", (e) => {
      let value = e.target.value.replace(/[^0-9]/g, "");
      e.target.value = value ? formatRupiah(value) : "";
    });
    
    
    // --- SCRIPT UNTUK DROPDOWN PRIORITAS UTAMA ---

const priorityBtn = document.getElementById('priority-btn');
const priorityMenu = document.getElementById('priority-menu');
const priorityLabel = document.getElementById('priority-label');
const priorityInput = document.getElementById('priority'); // Ini adalah input hidden
const priorityOptions = document.querySelectorAll('.priority-option');
const priorityArrow = priorityBtn.querySelector('svg');

// Fungsi untuk membuka/menutup menu
priorityBtn.addEventListener('click', () => {
  priorityMenu.classList.toggle('hidden');
  priorityArrow.classList.toggle('rotate-180');
});

// Fungsi saat salah satu opsi dipilih
priorityOptions.forEach(option => {
  option.addEventListener('click', () => {
    const selectedValue = option.getAttribute('data-value');
    const selectedText = option.textContent;

    // 1. Update nilai input hidden
    priorityInput.value = selectedValue;
    // 2. Update teks pada tombol yang terlihat
    priorityLabel.textContent = selectedText;

    // 3. Tutup menu
    priorityMenu.classList.add('hidden');
    priorityArrow.classList.remove('rotate-180');
  });
});

// Tutup dropdown jika pengguna mengklik di luar area dropdown
document.addEventListener('click', (e) => {
  if (!priorityBtn.contains(e.target) && !priorityMenu.contains(e.target)) {
    priorityMenu.classList.add('hidden');
    priorityArrow.classList.remove('rotate-180');
  }
});

    // filter dropdown
    const filterBtn = document.getElementById("filterBtn");
    const filterMenu = document.getElementById("filterMenu");
    filterBtn.addEventListener("click", () => filterMenu.classList.toggle("hidden"));
    document.addEventListener("click", (e) => {
      if (!filterBtn.contains(e.target) && !filterMenu.contains(e.target)) {
        filterMenu.classList.add("hidden");
      }
    });
    function setSort(value) {
      sortValue = value;
      render();
      filterMenu.classList.add("hidden");
    }

    // render list
    function render() {
      listEl.innerHTML = '';
      let items = [...todos];

      // sorting
      if (sortValue === "price") {
        items.sort((a, b) => parseInt(a.price.replace(/[^0-9]/g,"")) - parseInt(b.price.replace(/[^0-9]/g,"")));
      } else if (sortValue === "priority") {
        const order = { urgent: 1, important: 2, normal: 3 };
        items.sort((a, b) => {
          const pa = order[a.priority] || 4;
          const pb = order[b.priority] || 4;
          if (pa === pb) {
            return parseInt(a.price.replace(/[^0-9]/g,"")) - parseInt(b.price.replace(/[^0-9]/g,""));
          }
          return pa - pb;
        });
      } else if (sortValue === "alphabet") {
        items.sort((a, b) => a.title.localeCompare(b.title, "id"));
      } else if (sortValue === "time") {
        items.sort((a, b) => b.timestamp - a.timestamp);
      }

      items.forEach((t, i) => {
        const li = document.createElement('li');
        li.className = "p-3 border rounded-lg bg-white cursor-pointer flex flex-col";

        let actionsHTML = "";
        if (!isGrid) {
          // list → tombol horizontal
          actionsHTML = `
            <div id="actions-${i}" class="hidden mt-3 pt-2 border-t flex justify-between gap-2">
              <button onclick="toggleDone(${i})"
                class="flex-1 px-3 py-2 rounded text-sm font-medium ${t.done ? 'bg-green-500 text-white' : 'border text-green-600'}">
                ${t.done ? '✓ Terealisasikan' : 'Terealisasikan'}
              </button>
              <select onchange="updatePriority(${i}, this.value)"
                class="flex-1 px-3 py-2 rounded text-sm font-medium border bg-white focus:ring-2 focus:ring-teal-400">
                <option value="normal" ${t.priority==="normal" ? "selected" : ""}>Biasa</option>
                <option value="important" ${t.priority==="important" ? "selected" : ""}>Penting</option>
                <option value="urgent" ${t.priority==="urgent" ? "selected" : ""}>Realisasi dulu</option>
              </select>
              <button onclick="deleteItem(${i})"
                class="flex-1 px-3 py-2 rounded text-sm font-medium border text-red-600 hover:bg-red-50">
                Hapus
              </button>
            </div>`;
        } else {
          // grid → tombol vertikal, dorong card ke bawah
          actionsHTML = `
            <div id="actions-${i}" class="hidden mt-3 pt-2 border-t grid gap-2">
              <button onclick="toggleDone(${i})"
                class="w-full px-3 py-2 rounded text-sm font-medium ${t.done ? 'bg-green-500 text-white' : 'border text-green-600'}">
                ${t.done ? '✓ Terealisasikan' : 'Terealisasikan'}
              </button>
              <select onchange="updatePriority(${i}, this.value)"
                class="w-full px-3 py-2 rounded text-sm font-medium border bg-white focus:ring-2 focus:ring-teal-400">
                <option value="normal" ${t.priority==="normal" ? "selected" : ""}>Biasa</option>
                <option value="important" ${t.priority==="important" ? "selected" : ""}>Penting</option>
                <option value="urgent" ${t.priority==="urgent" ? "selected" : ""}>Realisasi dulu</option>
              </select>
              <button onclick="deleteItem(${i})"
                class="w-full px-3 py-2 rounded text-sm font-medium border text-red-600 hover:bg-red-50">
                Hapus
              </button>
            </div>`;
        }

        li.innerHTML = `
          <div class="flex items-start gap-3">
            ${t.photo ? `<img src="${t.photo}" class="w-16 h-16 object-cover rounded border" />` : ""}
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <h3 class="font-semibold">${t.title}</h3>
                ${t.priority === "important" ? `<span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded">Penting</span>` : ""}
                ${t.priority === "urgent" ? `<span class="px-2 py-1 text-xs bg-green-100 text-green-700 rounded">Realisasi dulu</span>` : ""}
              </div>
              <p class="text-sm text-gray-600">${t.price}</p>
              ${t.done ? `<span class="inline-block mt-1 text-xs px-2 py-1 bg-green-100 text-green-700 rounded">✓ Terealisasikan</span>` : ""}
            </div>
          </div>
          ${actionsHTML}
        `;

        li.addEventListener("click", (e) => {
          if (!e.target.closest("button") && !e.target.closest("select")) {
            // tutup semua action lain
            document.querySelectorAll("#list [id^='actions-']").forEach(el => {
              if (el !== li.querySelector(`#actions-${i}`)) {
                el.classList.add("hidden");
              }
            });
            // toggle hanya item ini
            const actionDiv = li.querySelector(`#actions-${i}`);
            actionDiv.classList.toggle("hidden");
          }
        });

        listEl.appendChild(li);
      });

      document.getElementById('count').textContent = `${items.length} item`;
    }

    function save(){ localStorage.setItem('todos', JSON.stringify(todos)); render(); }
    function toggleDone(i){ todos[i].done = !todos[i].done; save(); }
    function updatePriority(i, val){ todos[i].priority = val; save(); }
    function deleteItem(i){ todos.splice(i,1); save(); }
    
    // --- SCRIPT UNTUK MODAL KONFIRMASI ---

const confirmModal = document.getElementById('confirm-modal');
const cancelBtn = document.getElementById('cancel-btn');
const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

// Fungsi untuk menutup modal
function closeModal() {
  confirmModal.classList.add('hidden');
}

// Event listener untuk tombol Batal dan klik di luar modal (opsional)
cancelBtn.addEventListener('click', closeModal);
confirmModal.addEventListener('click', (e) => {
  // Jika yang diklik adalah area overlay (latar belakang), tutup modal
  if (e.target.id === 'confirm-modal') {
    closeModal();
  }
});

// Event listener untuk tombol "Ya, Hapus"
confirmDeleteBtn.addEventListener('click', () => {
  todos = []; // Kosongkan array todos
  save();     // Simpan perubahan dan render ulang
  closeModal(); // Tutup modal setelah selesai
});

    // form submit
    document.getElementById('itemForm').onsubmit = e=>{
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      const price = document.getElementById('price').value || "Rp 0";
      const priority = document.getElementById('priority').value;
      if(title){
        todos.push({ title, price, priority, done:false, photo: photoPreview.src || '', timestamp: Date.now() });
        e.target.reset(); photoPreview.classList.add('hidden'); photoPreview.src='';
        save();
      }
    };

    document.getElementById('clearBtn').onclick=()=>{
      document.getElementById('itemForm').reset();
      photoPreview.classList.add('hidden');
    };
	document.getElementById('clearAll').onclick = () => {
	document.getElementById('confirm-modal').classList.remove('hidden');
	};

    // photo preview
    photoInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = () => {
          photoPreview.src = reader.result;
          photoPreview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // Export TXT
    document.getElementById('exportBtn').onclick=()=>{
      const text = todos.map(t=>`${t.title} - ${t.price} ${t.done?'(Terealisasikan)':''} [${t.priority}]`).join('\n');
      const blob = new Blob([text], {type:'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'todos.txt';
      a.click();
    };

    // Grid/List toggle
const toggleBtn = document.getElementById('toggleView');
const gridIcon = document.getElementById('gridIcon');

// Definisikan bentuk SVG untuk setiap ikon
const iconListPath = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
const iconGridPath = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>';

// Atur ikon awal saat halaman dimuat
gridIcon.innerHTML = iconListPath;

toggleBtn.addEventListener('click', () => {
  // Toggle state
  isGrid = !isGrid;

  // Ubah layout DAN ikon berdasarkan state
  if (isGrid) {
    listEl.className = "grid grid-cols-2 md:grid-cols-3 gap-3 items-start";
    gridIcon.innerHTML = iconGridPath; // Set ikon ke Grid
  } else {
    listEl.className = "grid gap-3";
    gridIcon.innerHTML = iconListPath; // Set ikon ke List
  }
  
  // Render ulang list dengan layout baru
  render();
});

    // Deteksi browser untuk banner instal PWA
    let deferredPrompt;
    const userAgent = navigator.userAgent;
    const isKiwi = userAgent.includes('Kiwi');
    const isOperaGX = userAgent.includes('OPR GX');
    const isVia = userAgent.includes('Via');

    if (isKiwi || isOperaGX || isVia) {
        // Tampilkan banner manual untuk browser yang bermasalah
        manualInstallBanner.classList.remove('hidden');
        document.getElementById('closeManualBanner').onclick = () => {
            manualInstallBanner.classList.add('hidden');
        };
    } else {
        // Tampilkan banner normal untuk browser yang mendukung API
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.classList.remove('hidden');
        });
        document.getElementById('installBtn').onclick = async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                await deferredPrompt.userChoice;
                deferredPrompt = null;
                installBanner.classList.add('hidden');
            }
        };
        document.getElementById('closeBanner').onclick = () => {
            installBanner.classList.add('hidden');
        };
    }
    

    render();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>